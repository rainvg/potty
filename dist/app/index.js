var nappy=require("nappy"),path=require("path"),genocide=require("genocide"),version=require(path.resolve(__dirname,"..","..","package.json")).version;module.exports=function(e){"use strict";var n=this,o={sentence:2e3},s=e,t=require(s);if("function"!=typeof t)throw{code:3,description:"App is not a function.",url:""};var i={message:function(){},die:function(){}};process.on("disconnect",function(){i.die()}),n.on=function(e,n){if(!(e in i))throw{code:2,description:"Event does not exist.",url:""};i[e]=n},n.start=function(){process.send({cmd:"start"});var e=!1;process.on("message",function(n){if("setup"!==n.cmd||e)"message"===n.cmd&&i.message(n.message);else{e=!0;var s=function(){nappy.wait["for"](o.sentence).then(genocide.seppuku)};t({id:n.id,version:{main:n.version,potty:version},shutdown:function(){return new Promise(function(e){s(),process.send({cmd:"shutdown"}),process.on("message",function(n){"goodnight"===n.cmd&&e()})})},reboot:function(){return new Promise(function(e){s(),process.send({cmd:"reboot"}),process.on("message",function(n){"goodnight"===n.cmd&&e()})})},update:function(){return new Promise(function(e){s(),process.send({cmd:"update"}),process.on("message",function(n){"goodnight"===n.cmd&&e()})})},install:function(e){return new Promise(function(n){s(),process.send({cmd:"install",meta:{path:e}}),process.on("message",function(e){"goodnight"===e.cmd&&n()})})},on:function(e,n){if(!(e in i))throw{code:2,description:"Event does not exist.",url:""};i[e]=n},message:function(e){process.send({cmd:"message",message:e})}})}})}};