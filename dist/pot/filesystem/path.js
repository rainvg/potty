var nappy=require("nappy"),fs=require("fs-extra"),child_process=require("child_process"),__path__=require("path"),__logger__=require("../../logger");module.exports=function r(e){"use strict";if(!(this instanceof r))throw{code:1,description:"Constructor must be called with new.",url:""};var t=this,n={intervals:{retry:6e4}},o=e,i=__path__.resolve(o,"app"),s=__path__.resolve(o,"resources"),c={error:[]};t.root=function(){return o},t.app=function(){return i},t.resources=function(){return s};var _=function(r,e){if(!(r in c))throw{code:2,description:"Event does not exist.",url:""};c[r].forEach(function(r){r(e)})};t.on=function(r,e){if(!(r in c))throw{code:2,description:"Event does not exist.",url:""};c[r].push(e)},t.setup=function(){return new Promise(function(r){!function e(){__logger__.log("Setting up path ",o);try{fs.mkdirsSync(o),fs.mkdirsSync(i),fs.mkdirsSync(s),"win32"===process.platform&&child_process.execSync("attrib +h "+o),__logger__.log("Path set up."),r()}catch(t){__logger__.err("Failed setting up path."),_("error",t),nappy.wait["for"](n.intervals.retry).then(e)}}()})},t.clear={app:function(){return new Promise(function(r){!function e(){try{__logger__.log("Clearing",i,"folder."),fs.removeSync(i),r()}catch(t){__logger__.err("Failed clearing folder."),_("error",t),nappy.wait["for"](n.intervals.retry).then(e)}}()})}}};