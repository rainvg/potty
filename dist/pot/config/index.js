var confio=require("confio"),randomstring=require("randomstring"),nappy=require("nappy"),ospath=require("path");module.exports=function t(e){"use strict";if(!(this instanceof t))throw{code:0,description:"Constructor must be called with new.",url:""};var n=this,r={id:{length:16},fetch:{retry:{min:1e3,max:6048e5}},update:{retry:{min:1e3,max:6048e5}}},i=new confio.confio(e,ospath.resolve(__dirname,"..","..","..","config","pot.json"));n.id=function(){if(""===i.get("id"))try{i.set("id",randomstring.generate(r.id.length))}catch(t){}return i.get("id")},n.fetch={},n.fetch.reset=function(){try{i.set("fetch_retries",0)}catch(t){}},n.fetch.increment=function(){try{i.set("fetch_retries",i.get("fetch_retries")+1)}catch(t){}},n.fetch.now=function(){try{i.set("fetch_last",(new Date).getTime())}catch(t){}},n.fetch.wait=function(){return nappy.wait.till(i.get("fetch_last")+Math.min(Math.pow(2,i.get("fetch_retries"))*r.fetch.retry.min,r.fetch.retry.max))},n.update={},n.update.reset=function(){try{i.set("update_vain",0)}catch(t){}},n.update.increment=function(){try{i.set("update_vain",i.get("update_vain")+1)}catch(t){}},n.update.now=function(){try{i.set("update_last",(new Date).getTime())}catch(t){}},n.update.wait=function(){return(new Date).getTime()<i.get("update_last")+Math.min(Math.pow(2,i.get("update_vain"))*r.update.retry.min,r.update.retry.max)}};