var nappy=require("nappy"),genocide=require("genocide"),__logger__=require("../../../logger");module.exports=function e(n,o){"use strict";if(!(this instanceof e))throw{code:0,description:"Constructor must be called with new.",url:""};var t=this,i={sentence:2e3},c=o,r={cmd:null,args:[],executed:!1},u={"null":function(){},shutdown:function(){},reboot:function(){},update:function(){},install:function(){}},l=function(){__logger__.log("Sentencing child process."),nappy.wait["for"](i.sentence).then(function(){r.executed||(__logger__.err("Executing sentence."),r.cmd=null,genocide.genocide(c.pid))})};t.set=function(e,n){if(!(e&&e in u))throw{code:2,description:"Will not found.",url:""};if(r.executed)throw{code:3,description:"Will already executed.",url:""};r.cmd||l(),__logger__.log("Setting will to",e),n&&__logger__.log("Will arguments:",n),r={cmd:e,args:n||[],executed:!1}},t.once=function(e,n){if(!(e in u))throw{code:2,description:"Will not found.",url:""};u[e]=n},t.bury=function(e){r.executed||(__logger__.log("Burying child process."),r.executed=!0,genocide.genocide(c.pid),n.handle.set("bury",function(){}),n.handle.set("message",function(){}),u[r.cmd](r.args,e))},n.handle.set("bury",t.bury)};