var ospath=require("path"),__update__=require("../network/update.js"),__run__=require("./run.js"),__logger__=require("../../logger");module.exports=function e(r,n,o,t){"use strict";if(!(this instanceof e))throw{code:1,description:"Constructor must be called with new.",url:""};if(!o)throw{code:2,description:"A command is required.",url:""};var i=this,u=r,a=n,c="string"==typeof o?{command:o}:o;c.args=c.args||[],c.env=c.env||{},c.cwd=c.cwd||process.cwd();var d=t,s={error:[],shutdown:[],reboot:[],update:[],message:[],start:[]},_={message:function(){},bury:function(){}};i.version=function(){try{delete require.cache[require.resolve(ospath.resolve(a.app(),"package.json"))];var e=require(ospath.resolve(a.app(),"package.json")).version;return e}catch(r){return""}},i.run=function(e){__logger__.log("Running app."),__run__(i,c,d,e)},i.update=function(e){return __logger__.log("Updating app."),__update__(i,a,d,u,e)},i.handle={},i.handle.set=function(e,r){if(!(e in _))throw{code:2,description:"Handle not found.",url:""};_[e]=r},i.handle.call=function(e,r){if(!(e in _))throw{code:2,description:"Handle not found.",url:""};__logger__.log("App handle",e,"called with",r),_[e](r)},i.on=function(e,r){if(!(e in s))throw{code:2,description:"Event not found.",url:""};s[e].push(r)},i.trigger=function(e,r){if(!(e in s))throw{code:2,description:"Event not found.",url:""};__logger__.log("Event",e,"triggered."),r&&__logger__.log("Event value:",r),s[e].forEach(function(e){e(r)})}};