var nappy=require("nappy"),needle=require("needle"),__logger__=require("../../logger");module.exports=function e(r,o){"use strict";if(!(this instanceof e))throw{code:1,description:"Constructor must be called with new.",url:""};var t=this,n={needle:{open_timeout:1e4,read_timeout:5e3}};if(!r)throw{code:2,description:"URL must be provided.",url:""};var i,a=r,u=o||{};t.load=function(e){if(!i||e){__logger__.log("Loading remote package.");var r=function(){return new Promise(function(e,r){nappy.wait.connection().then(function(){needle.request("get",a,u,n.needle,function(o,t){if(o||200!==t.statusCode)return __logger__.err("Failed loading remote package:",o||t.statusCode),void r();try{i=JSON.parse(t.body),__logger__.log("Remote package loaded successfully."),e(i)}catch(o){__logger__.err("Failed parsing JSON:",o),r()}})})})};return new Promise(function(e){!function o(){r().then(e)["catch"](o)}()})}return Promise.resolve(i)}};