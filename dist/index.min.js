function pot(t,n,e){"use strict";var r={path_setup:{retry:1e3},setup:{retry:{min:1e3,max:6048e5}},pull:{retries:5}};if(!(this instanceof pot))throw{code:0,description:"Constructor must be called with new.",url:""};var o=this,i={root:t,app:path.resolve(t,"app"),resources:path.resolve(t,"resources")},u=n,c={local:e,remote:"origin/"+e},p=new confio.confio(path+"/potty.json",__dirname+"/../config/pot.json");o.path={root:function(){return i.root},app:function(){return i.app},resources:function(){return i.resources}},o.repository=function(){return u},o.branch={local:function(){return c.local},remote:function(){return c.remote}};var a=function(){var t=function(t){return new Promise(function(n,e){rimraf(t,function(){mkdirp(t,function(t){t?e(t):n()})})})};return new Promise(function(n){!function e(){t(i.app).then(function(){return t(i.resources)}).then(n)["catch"](function(){nappy.wait["for"](r.path_setup.retry).then(e)})}()})},s=function(){var t=function(){return nappy.wait.connection().then(function(){return nodegit.Clone(u,i.app,{checkoutBranch:c.local})})};return a().then(function(){return new Promise(function(n){nappy.wait.till(p.get("setup_last")+Math.min(Math.pow(2,p.get("setup_retries"))*r.setup.retry.min,r.setup.retry.max)).then(function(){try{p.set("setup_last",(new Date).getTime())}catch(e){}t().then(function(){try{p.set("setup_retries",0)}catch(t){}n()})["catch"](function(){try{p.set("setup_retries",p.get("setup_retries")+1)}catch(t){}s().then(n)})})})})},f=function(){var t=function(){return nappy.wait.connection().then(function(){return nodegit.Repository.open(i.app)}).then(function(t){return t.fetch("origin").then(function(){return t.mergeBranches(c.local,c.remote)})})};return new Promise(function(n){var e=0;!function o(){e<r.pull.retries?t().then(n)["catch"](function(){e++,o()}):s().then(n)}()})};o.update=function(){return f()}}var nappy=require("nappy"),nodegit=require("nodegit"),rimraf=require("rimraf"),mkdirp=require("mkdirp"),confio=require("confio"),path=require("path");module.exports={pot:pot};